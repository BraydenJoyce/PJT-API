Great question! To add more segment info to the financial statements, you need to edit the _get_statement_items() function. Here's how:
Where to Edit
Look for the _get_statement_items() method around line 80-210. You'll see three sections:

if statement_type == 'income':
elif statement_type == 'balance':
elif statement_type == 'cashflow':

How Segment Mapping Works
When you want a line item to show segment data, you add a suffix to the tag name:
python# Original tag (consolidated only)
('Revenues', 'Total sales and revenues'),

# With segments
('Revenues_MET', '     Sales of Machinery, Energy & Transportation'),
('Revenues_FinancialProducts', '     Revenues of Financial Products'),
('Revenues', 'Total sales and revenues'),  # Consolidated total
Available Segment Suffixes
The script maps these suffixes to actual XBRL segment names:
python'_FinancialProducts' or '_FP'  →  Financial Products segment
'_MET'                          →  Machinery, Energy & Transportation segment
(no suffix)                     →  Consolidated data
Example: Adding Segment to Operating Income
Let's say you want to break down Operating Income by segment:
Find this in the income statement section:
python('OperatingIncomeLoss', 'Operating Profit'),
Change it to:
python('OperatingIncomeLoss_MET', '     Operating Profit - Machinery, Energy & Transportation'),
('OperatingIncomeLoss_FP', '     Operating Profit - Financial Products'),
('OperatingIncomeLoss', 'Operating Profit - Total'),
Example: Adding Segment to Balance Sheet Assets
Find this in the balance sheet section:
python('Assets', 'Total assets'),
Change it to:
python('Assets_MET', '     Total Assets - Machinery, Energy & Transportation'),
('Assets_FP', '     Total Assets - Financial Products'),
('Assets', 'Total assets'),
Full Example - Adding Segments to Cost of Revenue
Here's a complete before/after:
Before:
pythonif statement_type == 'income':
    return OrderedDict([
        ('Revenues', '     Total sales and revenues'),
        ('', ''),
        ('CostOfRevenue', '     Cost of goods sold'),
        ('OperatingIncomeLoss', 'Operating Profit'),
    ])
After (with segments):
pythonif statement_type == 'income':
    return OrderedDict([
        ('Revenues_MET', '     Sales of Machinery, Energy & Transportation'),
        ('Revenues_FP', '     Revenues of Financial Products'),
        ('Revenues', '     Total sales and revenues'),
        
        ('', ''),
        ('CostOfRevenue_MET', '     Cost of goods sold - Machinery, Energy & Transportation'),
        ('CostOfRevenue_FP', '     Cost of goods sold - Financial Products'),
        ('CostOfRevenue', '     Cost of goods sold - Total'),
        
        ('', ''),
        ('OperatingIncomeLoss_MET', '     Operating Profit - Machinery, Energy & Transportation'),
        ('OperatingIncomeLoss_FP', '     Operating Profit - Financial Products'),
        ('OperatingIncomeLoss', 'Operating Profit'),
    ])
Important Notes

The suffix must match the segment map in the create_statement_pivot() function (around line 570):

python   segment_map = {
       'FinancialProducts': 'FinancialProductsMember',
       'FP': 'FinancialProductsMember',
       'MET': 'MachineryEnergyAndTransportationMember',
   }

Order matters - List segment breakdowns first, then the consolidated total
Blank rows - Use ('', '') to add spacing
The script will automatically:

Extract the segment data from XBRL
Calculate Q4 for each segment separately
Display them in your specified order



Want me to add specific segments for you?
Just tell me which line items you want broken down by segment, and I'll show you exactly what to add!


